---
import { getTranslations } from "../i18n";

interface Props {
  id: string;
  name: string;
  tradeLabel: string;
  locationLabel?: string;
  rating?: number | null;
  reviewsCount?: number;
  rate?: number | null;
  rateType?: string; // ‚Üê AGREGADO para mostrar tipo de tarifa
  minimumHours?: number | null; // ‚Üê AGREGADO para mostrar horas m√≠nimas
  experienceLabel: string | boolean;
  verified?: boolean;
  image?: string;
  bio?: string;
  skills?: string[];
  locale?: string; // ‚Üê AGREGADO para traducciones
}

const {
  id,
  name,
  tradeLabel,
  locationLabel = "",
  rating = null,
  reviewsCount = 0,
  rate = null,
  rateType = "",
  minimumHours = null,
  experienceLabel = "",
  verified = false,
  image = "üë§",
  bio = "",
  skills = [],
  locale = "es",
} = Astro.props;

const t = getTranslations(locale);

const safeRating =
  typeof rating === "number" && Number.isFinite(rating) ? rating : null;

const shownSkills = (Array.isArray(skills) ? skills : []).slice(0, 3);

// ‚úÖ REFACTORIZADO: Determinar texto del tipo de tarifa
const rateTypeLabels = {
  hourly: t.rateType.hourly,
  fixed: t.rateType.fixed,
  negotiable: t.rateType.negotiable,
};

const rateTypeText = rateTypeLabels[rateType];

const formatedRate =
  rateType == null
    ? "A convenir"
    : new Intl.NumberFormat(locale, {
        style: "currency",
        currency: t.general.currencyCode,
        maximumFractionDigits: 0, // si quer√©s sin centavos
      }).format(Number(rate));
---

<a
  href={`/profile/${id}`}
  class="bg-white rounded-xl overflow-hidden border-2 border-[#E07A5F] hover:shadow-xl transition-all group block"
>
  <div class="p-6">
    <!-- Header: Avatar + Info + Badge -->
    <div class="flex items-start gap-4 mb-4">
      <!-- Avatar -->
      <div
        class="w-20 h-20 bg-gradient-to-br from-[#E07A5F] to-[#F4A261] rounded-full flex items-center justify-center text-4xl shrink-0"
        aria-hidden="true"
      >
        {image}
      </div>

      <!-- Info Column -->
      <div class="flex-1 min-w-0">
        <!-- Name (big, coral color) -->
        <h3
          class="text-2xl font-bold text-[#E07A5F] mb-1 truncate"
          title={name}
        >
          {name}
        </h3>

        <!-- Location -->
        {
          locationLabel && (
            <div class="text-base text-gray-600 mb-1">üìç {locationLabel}</div>
          )
        }

        <!-- Trade/Oficio -->
        <div class="text-base text-gray-600">{tradeLabel}</div>
      </div>

      <!-- Verified Badge -->
      {
        verified && (
          <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium whitespace-nowrap">
            {t.profile.verifiedPro}
          </div>
        )
      }
    </div>

    <!-- Rating + Price Row -->
    <div class="flex items-start justify-between mb-4">
      <!-- Rating (left) -->
      <div class="flex items-center gap-1">
        {
          safeRating != null ? (
            <>
              <span class="text-2xl font-bold text-gray-900">
                {safeRating.toFixed(1)}
              </span>
              <span class="text-gray-500 text-base">({reviewsCount})</span>
            </>
          ) : (
            <span class="text-gray-500 text-sm">{t.reviews.none.text}</span>
          )
        }
      </div>

      <!-- ‚úÖ REFACTORIZADO: Price (right) -->
      <div class="text-right">
        <div class="text-3xl font-bold text-gray-900">{formatedRate}</div>
        {
          rateTypeText && (
            <div class="text-sm text-gray-500">{rateTypeText}</div>
          )
        }
        {
          rateType === "hourly" && minimumHours != null && (
            <div class="text-sm text-gray-500">
              {minimumHours} {t.rateType.minimumHours}
            </div>
          )
        }
      </div>
    </div>

    <!-- Bio -->
    {bio && <p class="text-gray-600 text-base mb-4 line-clamp-2">{bio}</p>}

    <!-- Experience -->
    {
      experienceLabel && (
        <div class="text-base text-gray-600 mb-4">{experienceLabel}</div>
      )
    }

    <!-- Skills -->
    {
      shownSkills.length > 0 && (
        <div class="flex flex-wrap gap-2">
          {shownSkills.map((skill) => (
            <span class="bg-gray-100 text-gray-700 px-3 py-1.5 rounded-md text-sm font-medium">
              {skill}
            </span>
          ))}
        </div>
      )
    }
  </div>
</a>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

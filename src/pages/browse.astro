---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import TaskerCard from '../components/TaskerCard.astro';
import AdBanner from '../components/AdBanner.astro';
import { getTranslations } from '../i18n';
import { taskers, categories, getTaskersByCategory, searchTaskers } from '../data/taskers';

const locale = 'es';
const t = getTranslations(locale);

// Get query parameters
const url = new URL(Astro.request.url);
const category = url.searchParams.get('category');
const searchQuery = url.searchParams.get('q');

// Filter taskers
let filteredTaskers = taskers;
let title = t.browse.allTaskers;

if (category) {
  filteredTaskers = getTaskersByCategory(category);
  const cat = categories.find(c => c.id === category);
  title = cat ? t.categories[cat.id] : t.browse.allTaskers;
} else if (searchQuery) {
  filteredTaskers = searchTaskers(searchQuery);
  title = t.browse.searchResults;
}
---

<Layout 
  title={`${title} - HomeHelper`}
  description="Encuentra profesionales verificados en tu √°rea"
  locale={locale}
>
  <Header locale={locale} />

  <div class="min-h-screen bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-6 sm:py-8">
      <div class="mb-6">
        <div class="flex items-center justify-between mb-4">
          <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 font-serif">
            {title}
          </h1>
          {category && (
            <a
              href="/browse"
              class="text-[#E07A5F] font-medium text-sm hover:underline"
            >
              {t.browse.clearFilter}
            </a>
          )}
        </div>
        
        <div class="overflow-x-auto pb-2 -mx-4 px-4 sm:mx-0 sm:px-0">
          <div class="flex space-x-2 min-w-max sm:min-w-0 sm:flex-wrap">
            {categories.map((cat) => (
              <a
                href={`/browse?category=${cat.id}`}
                class:list={[
                  "px-4 py-2 rounded-full font-medium text-sm whitespace-nowrap transition-all",
                  category === cat.id
                    ? "bg-[#E07A5F] text-white"
                    : "bg-white text-gray-700 border border-gray-200 hover:border-[#E07A5F]"
                ]}
              >
                {cat.icon} {t.categories[cat.id]}
              </a>
            ))}
          </div>
        </div>
      </div>

      <AdBanner locale={locale} />

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {filteredTaskers.map((tasker, index) => (
          <>
            <TaskerCard
              id={tasker.id.toString()}
              name={t.taskers[tasker.nameKey].name}
              category={tasker.category}
              rating={tasker.rating}
              reviews={tasker.reviews}
              hourlyRate={tasker.hourlyRate}
              location={tasker.location}
              experience={tasker.experience}
              verified={tasker.verified}
              image={tasker.image}
              bio={t.taskers[tasker.nameKey].bio}
              skills={t.taskers[tasker.nameKey].skills}
              availability={t.availability[
                ['monSat', 'tueSun', 'monFri', 'monSat', 'flexible', 'twentyFourSeven'][tasker.id - 1]
              ]}
              locale={locale}
            />
            {(index + 1) % 3 === 0 && index < filteredTaskers.length - 1 && (
              <div class="md:col-span-2 lg:col-span-3">
                <AdBanner locale={locale} />
              </div>
            )}
          </>
        ))}
      </div>

      {filteredTaskers.length === 0 && (
        <div class="text-center py-16">
          <div class="text-6xl mb-4">üîç</div>
          <h3 class="text-2xl font-bold text-gray-900 mb-2">{t.browse.noResults}</h3>
          <p class="text-gray-600 mb-6">{t.browse.noResultsDesc}</p>
          <a
            href="/browse"
            class="inline-block bg-[#E07A5F] text-white px-6 py-3 rounded-lg font-medium hover:bg-[#d46c51] transition-colors"
          >
            {t.browse.viewAll}
          </a>
        </div>
      )}
    </div>
  </div>
</Layout>

---
import { getManerById } from "../../lib/queries/getManers";
import { getTranslations } from "../../i18n";
import { resolveRequestLocale } from "../../i18n/resolveRequestLocale";
import Layout from "../../layouts/Layout.astro";
import AdBanner from "../../components/AdBanner.astro";

const { id } = Astro.params;
const locale = resolveRequestLocale(Astro.request);
const t = getTranslations(locale);

if (!id) {
  return Astro.redirect("/404");
}

const maner = await getManerById(id, locale);

if (!maner) {
  return Astro.redirect("/404");
}

const rateDisplay =
  maner.rate == null
    ? "A convenir"
    : new Intl.NumberFormat(locale, {
        style: "currency",
        currency: t.general.currencyCode,
        maximumFractionDigits: 0, // si quer√©s sin centavos
      }).format(Number(maner.rate));

const rateTypeLabels = {
  hourly: t.rateType.hourly,
  fixed: t.rateType.fixed,
  negotiable: t.rateType.negotiable,
};

const rateType = rateTypeLabels[maner.rateType || "negotiable"];

const experienceLabel =
  maner.experienceYears != null
    ? `${maner.experienceYears} ${t.time.years} de ${t.browse.experience}`
    : "";

// Disponibilidad (hardcoded por ahora - agregar a DB despu√©s)
const availabilityLabel = "Lun-S√°b, 8am-6pm";
---

<Layout
  title={`${maner.name} - ${maner.tradeLabel || ""} - Manify`}
  description={maner.bio || `Perfil de ${maner.name}, ${maner.tradeLabel}`}
>
  <main class="min-h-screen bg-gray-50">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 py-8">
      <!-- Back Button -->
      <a
        href="/browse"
        class="inline-flex items-center text-gray-600 hover:text-gray-900 mb-6"
      >
        ‚Üê {t.profile.backToResults}
      </a>

      <!-- Header Card - Orange Background -->
      <div
        class="bg-gradient-to-r from-[#E07A5F] to-[#F4A261] rounded-xl shadow-lg p-8 mb-6 text-white"
      >
        <div class="flex items-start gap-6">
          <!-- Avatar -->
          <div
            class="w-32 h-32 bg-white rounded-full flex items-center justify-center text-6xl shrink-0"
          >
            {maner.avatar || "üë§"}
          </div>

          <!-- Info -->
          <div class="flex-1">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <h1 class="text-4xl font-bold mb-2">
                  {maner.name}
                </h1>

                {
                  maner.location && (
                    <div class="flex items-center text-lg mb-3 opacity-90">
                      üìç {maner.location}
                    </div>
                  )
                }

                <div class="flex items-center gap-4 text-lg">
                  {
                    maner.rating != null && (
                      <div class="flex items-center gap-2">
                        <span class="text-2xl">‚≠ê</span>
                        <span class="font-bold">{maner.rating.toFixed(1)}</span>
                        <span class="opacity-90">
                          ({maner.reviewsCount} {t.profile.reviews})
                        </span>
                      </div>
                    )
                  }

                  {
                    experienceLabel && (
                      <>
                        <span class="opacity-50">‚Ä¢</span>
                        <span class="opacity-90">{experienceLabel}</span>
                      </>
                    )
                  }
                </div>
              </div>

              <!-- Verified Badge -->
              {
                maner.verified && (
                  <div class="bg-green-600 text-white px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 whitespace-nowrap">
                    <span>‚úì</span>
                    <span>{t.profile.verifiedPro}</span>
                  </div>
                )
              }
            </div>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
        <!-- Rate & Availability Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <!-- Tarifa por Hora -->
          <div class="bg-gray-100 rounded-xl p-6">
            <div class="text-sm text-gray-600 mb-2">
              {rateType}
            </div>
            <div class="text-4xl font-bold text-gray-900">{rateDisplay}</div>
          </div>

          <!-- Disponibilidad -->
          <div class="bg-gray-100 rounded-xl p-6">
            <div class="text-sm text-gray-600 mb-2">
              {locale === "es" ? "Disponibilidad" : "Disponibilidade"}
            </div>
            <div class="text-xl font-bold text-gray-900">
              {availabilityLabel}
            </div>
          </div>
        </div>

        <!-- Acerca de -->
        {
          maner.bio && (
            <div class="bg-white rounded-xl shadow-sm p-8 mb-6">
              <h2 class="text-2xl font-bold text-gray-900 mb-4">
                {t.profile.about}
              </h2>
              <p class="text-gray-700 text-lg leading-relaxed">{maner.bio}</p>
            </div>
          )
        }

        <!-- Habilidades y Servicios -->
        {
          maner.skills.length > 0 && (
            <div class="bg-white rounded-xl shadow-sm p-8 mb-6">
              <h2 class="text-2xl font-bold text-gray-900 mb-4">
                {t.profile.skills}
              </h2>
              <div class="flex flex-wrap gap-3">
                {maner.skills.map((skill) => (
                  <span class="bg-[#FFE5E0] text-[#E07A5F] px-4 py-2 rounded-lg font-medium">
                    {skill}
                  </span>
                ))}
              </div>
            </div>
          )
        }

        <!-- Patrocinado Card (opcional) -->
        <AdBanner t={t} />

        <!-- Action Buttons -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          <button
            class="bg-[#E07A5F] text-white px-8 py-4 rounded-xl text-lg font-bold hover:bg-[#d46c51] transition-colors flex items-center justify-center gap-2"
          >
            <span class="text-xl">üìû</span>
            {t.profile.callNow}
          </button>

          <button
            class="bg-white border-2 border-[#E07A5F] text-[#E07A5F] px-8 py-4 rounded-xl text-lg font-bold hover:bg-[#FFF5F3] transition-colors flex items-center justify-center gap-2"
          >
            <span class="text-xl">‚úâÔ∏è</span>
            {t.profile.sendMessage}
          </button>
        </div>
      </div>

      <!-- Rese√±as Recientes -->
      <div class="bg-white rounded-xl shadow-sm p-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">
          {t.profile.recentReviews}
        </h2>

        <!-- Review 1 -->
        <div class="mb-6 pb-6 border-b border-gray-200">
          <div class="flex items-start justify-between mb-2">
            <div>
              <div class="font-bold text-gray-900">John D.</div>
              <div class="flex items-center gap-1 mt-1">
                <span class="text-yellow-400">‚≠ê</span>
                <span class="text-yellow-400">‚≠ê</span>
                <span class="text-yellow-400">‚≠ê</span>
                <span class="text-yellow-400">‚≠ê</span>
                <span class="text-yellow-400">‚≠ê</span>
              </div>
            </div>
            <div class="text-sm text-gray-500">hace 2 d√≠as</div>
          </div>
          <p class="text-gray-700">
            ¬°Excelente trabajo! Muy profesional y complet√≥ el trabajo antes de
            lo programado.
          </p>
        </div>

        <!-- Review 2 -->
        <div class="mb-6 pb-6 border-b border-gray-200">
          <div class="flex items-start justify-between mb-2">
            <div>
              <div class="font-bold text-gray-900">Sarah M.</div>
              <div class="flex items-center gap-1 mt-1">
                <span class="text-yellow-400">‚≠ê</span>
                <span class="text-yellow-400">‚≠ê</span>
                <span class="text-yellow-400">‚≠ê</span>
                <span class="text-yellow-400">‚≠ê</span>
                <span class="text-yellow-400">‚≠ê</span>
              </div>
            </div>
            <div class="text-sm text-gray-500">hace 1 semana</div>
          </div>
          <p class="text-gray-700">
            ¬°Altamente recomendado! Gran comunicaci√≥n y servicio de calidad.
          </p>
        </div>

        <!-- Review 3 -->
        <div>
          <div class="flex items-start justify-between mb-2">
            <div>
              <div class="font-bold text-gray-900">Michael R.</div>
              <div class="flex items-center gap-1 mt-1">
                <span class="text-yellow-400">‚≠ê</span>
                <span class="text-yellow-400">‚≠ê</span>
                <span class="text-yellow-400">‚≠ê</span>
                <span class="text-yellow-400">‚≠ê</span>
                <span class="text-gray-300">‚≠ê</span>
              </div>
            </div>
            <div class="text-sm text-gray-500">hace 2 semanas</div>
          </div>
          <p class="text-gray-700">
            Buena experiencia en general. Contratar√≠a nuevamente para proyectos
            futuros.
          </p>
        </div>
      </div>
    </div>
  </main>
</Layout>
